name: ci

on:
  push:
    branches:
      - 'main'

jobs:
  docker:
    runs-on: ubuntu-latest
    env:
      NV_LOGIN_JSON: '{"password":{"username":"admin","password":"admin"}}'
      NV_SCANNING_JSON: '{"request":{"registry":"","username":"","password":"","repository":"bashofmann/neuvector-github-action-example","tag":"latest"}}'
    steps:
      - uses: actions/checkout@v1
      - name: Build Image
        run: |
          docker build . --tag bashofmann/neuvector-github-action-example:latest
      - name: Scan Image
        uses: bashofmann/neuvector-image-scan-action@main
        with:
          image-repository: bashofmann
          image-tag: latest
          min-high-cves-to-fail: '1'
          min-medium-cves-to-fail: '1'